<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>3</epicId>
    <storyId>3</storyId>
    <title>Manual Filtering and Sorting</title>
    <status>drafted</status>
    <generatedAt>mandag 1. desember 2025</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/3-3-manual-filtering-and-sorting.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>a user</asA>
    <iWant>flexible manual filtering and sorting options for my tasks</iWant>
    <soThat>I can easily customize my task view and maintain full control over my workload</soThat>
    <tasks>
*   **1. Backend Implementation:**
    *   [ ] Modify existing `GET /api/tasks` Flask route in `app.py` to accept optional `label`, `sort_by`, and `order` query parameters.
    *   [ ] Implement logic in `app.py` to filter tasks from the `Task` model by the `label` field. (Source: `docs/fase-3-solutioning/architecture.md#Data-Models`)
    *   [ ] Implement logic in `app.py` to sort tasks from the `Task` model by `priority` (High to Low by default) and `due_date` (soonest first by default), respecting the `order` parameter.
*   **2. Frontend Implementation:**
    *   [ ] Implement a "Filter by Label" dropdown in `templates/index.html` (or relevant template), populating options from available labels.
    *   [ ] Implement "Sort by" controls (e.g., dropdown or buttons) for `Priority` and `Due Date` in `templates/index.html`.
    *   [ ] Implement JavaScript event handlers for filter and sort controls that send API requests to `GET /api/tasks` with the appropriate `label`, `sort_by`, and `order` query parameters.
    *   [ ] Update the main task list display based on the filtered and sorted response from the API.
*   **3. Testing:**
    *   [ ] **Unit Test**: Verify the database query logic correctly filters tasks by label.
    *   [ ] **Unit Test**: Verify the database query logic correctly sorts tasks by priority (ASC/DESC).
    *   [ ] **Unit Test**: Verify the database query logic correctly sorts tasks by due date (ASC/DESC).
    *   [ ] **Integration Test**: Verify the `GET /api/tasks` endpoint returns tasks filtered by label and sorted by priority/due date.
    *   [ ] **E2E Test**: Using Playwright, simulate user interactions with filter and sort controls and verify that the task list updates correctly. (Source: `docs/sprint-artifacts/tech-spec-epic-3.md#Test-Strategy-Summary`)
    </tasks>
  </story>

  <acceptanceCriteria>
1.  **Given** I am viewing my tasks, **when** I select a label from a "Filter by Label" dropdown, **then** the task list is filtered to show only tasks with that label.
2.  **When** I choose to sort by priority, **then** the tasks are ordered from High to Low.
3.  **When** I choose to sort by due date, **then** the tasks are ordered with the soonest due date first.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/fase-2-planning/prd.md</path>
        <title>Product Requirements Document</title>
        <section>Functional Requirements</section>
        <snippet>FR14: Users can filter tasks by a specific label. FR15: Users can sort tasks by priority. FR16: Users can sort tasks by due date.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: Smart lists &amp; advanced filtering</title>
        <section>Objectives and Scope</section>
        <snippet>Functionality to filter tasks by a specific label. Functionality to sort tasks by priority. Functionality to sort tasks by due date.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: Smart lists &amp; advanced filtering</title>
        <section>APIs and Interfaces</section>
        <snippet>GET /api/tasks: Retrieves a list of tasks, with options for filtering and sorting. Query Parameters: label, sort_by, order.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: Smart lists &amp; advanced filtering</title>
        <section>Workflows and Sequencing</section>
        <snippet>User selects a label from a "Filter by Label" dropdown. Frontend sends GET /api/tasks?label=Work to the backend. Updates the UI to reflect the filter. User selects "Priority" from a "Sort by" dropdown, then "Descending" from "Order". Frontend sends GET /api/tasks?sort_by=priority&amp;order=desc to the backend. Updates the UI to display tasks sorted by priority descending.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: Smart lists &amp; advanced filtering</title>
        <section>Risks, Assumptions, Open Questions</section>
        <snippet>Open Question: Filtering Combinations: How many filter/sort combinations should the UI support simultaneously? Open Question: Default Sort Order: What should be the default sort order for the main task list when no specific sort is applied?</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-3.md</path>
        <title>Epic Technical Specification: Smart lists &amp; advanced filtering</title>
        <section>Traceability Mapping</section>
        <snippet>AC 5, 6, 7 (Story 3.3) maps to Frontend, app.py (GET /api/tasks?label=...&amp;sort_by=...) for E2E Test: User uses filter/sort controls, verifies filtered/sorted results.</snippet>
      </doc>
      <doc>
        <path>docs/fase-3-solutioning/architecture.md</path>
        <title>Architecture</title>
        <section>Epic to Architecture Mapping</section>
        <snippet>Epic 3: Smart Lists &amp; Advanced Filtering maps to app.py, templates/, instance/tasks.db.</snippet>
      </doc>
      <doc>
        <path>docs/fase-3-solutioning/architecture.md</path>
        <title>Architecture</title>
        <section>Data Models</section>
        <snippet>Task Model: label | String(50) | Nullable | A category for the task (e.g., Work, Personal). Task Model: priority | String(20) | Not Nullable, Default='Medium' | Priority level (e.g., Low, Medium, High). Task Model: due_date | Date | Nullable | When the task is due.</snippet>
      </doc>
      <doc>
        <path>docs/fase-2-planning/ux-design-specification.md</path>
        <title>ibe160 UX Design Specification</title>
        <section>UX Pattern Decisions</section>
        <snippet>Search Patterns: Search inputs will feature a clear magnifying glass icon, a placeholder text (e.g., "Search tasks..."), and a clear button or 'X' icon to clear the search query.</snippet>
      </doc>
      <doc>
        <path>docs/fase-2-planning/ux-design-specification.md</path>
        <title>ibe160 UX Design Specification</title>
        <section>Form Patterns</section>
        <snippet>Form Patterns: Labels will be placed directly above input fields for clarity.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>app.py</path>
        <kind>Flask Application</kind>
        <symbol>GET /api/tasks</symbol>
        <reason>Endpoint to be extended for label filtering and priority/due_date sorting.</reason>
      </artifact>
      <artifact>
        <path>instance/tasks.db</path>
        <kind>SQLite Database</kind>
        <symbol>Task table</symbol>
        <reason>Data persistence layer, 'label', 'priority', 'due_date' columns relevant for filtering/sorting.</reason>
      </artifact>
      <artifact>
        <path>templates/index.html</path>
        <kind>Frontend Template</kind>
        <reason>Needs modification to add filter by label dropdown and sort by controls.</reason>
      </artifact>
    </code>
    <dependencies>
      <dependency>
        <ecosystem>Python</ecosystem>
        <package>Flask</package>
        <version>3.1.2</version>
      </dependency>
      <dependency>
        <ecosystem>Python</ecosystem>
        <package>Flask-SQLAlchemy</package>
        <version>3.1.2</version>
      </dependency>
      <dependency>
        <ecosystem>Python</ecosystem>
        <package>datetime</package>
        <version>Built-in</version>
        <note>Potentially relevant for `due_date` sorting logic.</note>
      </dependency>
      <dependency>
        <ecosystem>Node.js</ecosystem>
        <package>tailwindcss</package>
        <version>4.1.17</version>
      </dependency>
      <dependency>
        <ecosystem>Node.js</ecosystem>
        <package>postcss</package>
        <version>8.5.6</version>
      </dependency>
      <dependency>
        <ecosystem>Node.js</ecosystem>
        <package>autoprefixer</package>
        <version>10.4.22</version>
      </dependency>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Backend implementation must use Python/Flask and Flask-SQLAlchemy for database interaction, handling filtering by label and sorting by priority/due_date.</constraint>
    <constraint>Frontend UI must use TailwindCSS for styling and adhere to UX Design Specification regarding filter/sort controls.</constraint>
    <constraint>Consider adding database indexes to the 'label', 'priority', and 'due_date' columns in the Task table for performance optimization.</constraint>
    <constraint>Ensure all API calls are authenticated as per existing Flask session-based authentication.</constraint>
    <constraint>Address the open questions regarding "Filtering Combinations" and "Default Sort Order" during implementation and UI design.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>GET /api/tasks (filter by label, sort by priority/due_date)</name>
      <kind>REST Endpoint</kind>
      <signature>GET /api/tasks?label=&lt;label&gt;&amp;sort_by=&lt;field&gt;&amp;order=&lt;asc/desc&gt;</signature>
      <path>app.py</path>
    </interface>
  </interfaces>
  <tests>
    <standards>
      <standard>Unit Tests: `pytest` for core logic for filtering by label and sorting by priority/due_date.</standard>
      <standard>Integration/API Tests: `pytest` for `GET /api/tasks` endpoint validation with various combinations of `label`, `sort_by`, `order` parameters.</standard>
      <standard>End-to-End (E2E) Tests: Playwright for UI interaction and functional verification of filter/sort controls and displayed results.</standard>
      <standard>Performance Testing: `k6` for API load testing of the `GET /api/tasks` endpoint with filter/sort parameters to ensure responsiveness.</standard>
    </standards>
    <locations>
      <location>tests/</location>
      <location>tests/e2e/</location>
    </locations>
    <ideas>
      <idea ac-ref="1">E2E Test: User selects a label from the dropdown, verifies only tasks with that label are displayed.</idea>
      <idea ac-ref="2">E2E Test: User sorts by priority (High to Low), verifies tasks are correctly ordered.</idea>
      <idea ac-ref="3">E2E Test: User sorts by due date (soonest first), verifies tasks are correctly ordered.</idea>
      <idea ac-ref="1">Integration Test: Call `GET /api/tasks?label=Work` and assert that only tasks with 'Work' label are returned.</idea>
      <idea ac-ref="2">Integration Test: Call `GET /api/tasks?sort_by=priority&amp;order=desc` and assert correct sorting order.</idea>
      <idea ac-ref="3">Integration Test: Call `GET /api/tasks?sort_by=due_date&amp;order=asc` and assert correct sorting order.</idea>
      <idea ac-ref="1,2,3">Unit Test: Verify database query logic for filtering by label, and sorting by priority and due date.</idea>
    </ideas>
  </tests>
</story-context>
